<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Main page</title>
</head>

<body>
    <main>
        <section class="demo-mode">
            <img src="../assets/top-banner.png" alt="Top Banner" class="banner">
        </section>
        <section class="run-mode">
            <h2 class="title"></h2>
            <div class="content">
            </div>
        </section>
    </main>

    <script>

        const banner = document.querySelector(".banner");
        const demoModeSection = document.querySelector(".demo-mode");
        const runModeSection = document.querySelector(".run-mode");
        const randomIndicesBag = new Set();
        updateBannerAnimation();
        banner.onanimationend = event => {
            const animationName = event.target.style.getPropertyValue("animation-name").split(",").pop().trim();
            if (animationName == event.animationName) {
                updateBannerAnimation();
            }
        };

        demoModeSection.style.display = "none";
        runModeSection.style.display = "none";
        onmessage = ({ data }) => {
            if (data.type == "showDemoMode") {
                runModeSection.style.display = "none";
                demoModeSection.style.display = "flex";
            }
            if (data.type == "showRunStart") {
                demoModeSection.style.display = "none";
                runModeSection.style.display = "flex";
                runModeSection.querySelector(".title").textContent = data.description;
                runModeSection.querySelector(".content").textContent = data.content;
            }
            if (data.type == "showRunComplete") {
                runModeSection.querySelector(".title").textContent = "Run Complete";
                runModeSection.querySelector(".content").textContent = "";
            }
        };
        parent.postMessage({}, "*");

        function updateBannerAnimation() {
            const {
                name: animationName,
                direction: animationDirection
            } = getRandomAnimationProperties();
            banner.style.animation = "none";
            void banner.offsetWidth;
            banner.style.animation = "";
            banner.style.setProperty("animation-name", animationName);
            banner.style.setProperty("animation-direction", animationDirection);

        }

        function getRandomAnimationProperties() {
            const transformAnimationNames = ["rotate-x", "rotate-y", "rotate-z", "scale-x", "scale-y", "scale-xy", "skew-1", "skew-2", "skew-3", "shake-x", "shake-y",];
            const filterAnimationNames = ["fade-in-out", "grayscale", "contrast", "hue-rotate"];
            let animationIndex = 0;
            let selectedAnimationNames = [];
            const animationCount = Math.floor(Math.random() * 4) + 1;
            const selectedTransformAnimationNames = [];
            const selectedFilterAnimationNames = [];
            const selectedAnimationDirections = [];
            for (let indexRandomAnimation = 0; indexRandomAnimation < Math.floor(Math.random() * 4) + 2; indexRandomAnimation++) {
                const randomIndex = Math.floor(Math.random() * transformAnimationNames.length);
                if (!selectedTransformAnimationNames.includes(transformAnimationNames[randomIndex])) {
                    selectedTransformAnimationNames.push(transformAnimationNames[randomIndex]);
                    selectedAnimationDirections.push(Math.random() < 0.5 ? "reverse" : "normal");
                }
            }
            for (let indexRandomAnimation = 0; indexRandomAnimation < Math.floor(Math.random() * 2) + 1; indexRandomAnimation++) {
                const randomIndex = Math.floor(Math.random() * filterAnimationNames.length);
                if (!selectedFilterAnimationNames.includes(filterAnimationNames[randomIndex])) {
                    selectedFilterAnimationNames.push(filterAnimationNames[randomIndex]);
                    selectedAnimationDirections.push(Math.random() < 0.5 ? "reverse" : "normal");
                }
            }
            return {
                name: [...selectedTransformAnimationNames, ...selectedFilterAnimationNames].join(","),
                direction: selectedAnimationDirections.join(",")
            };
        }

    </script>
</body>

</html>