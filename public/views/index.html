<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Main page</title>
</head>

<body>
    <main>
        <section class="demo-mode">
            <img src="../assets/top-banner.png" alt="Top Banner" class="banner">
        </section>
        <section class="run-mode">
            <h2 class="title"></h2>
            <div class="content">
            </div>
        </section>
    </main>

    <script>

        const banner = document.querySelector(".banner");
        const demoModeSection = document.querySelector(".demo-mode");
        const runModeSection = document.querySelector(".run-mode");
        const randomIndicesBag = new Set();
        updateBannerAnimation();
        banner.onanimationend = () => updateBannerAnimation();

        demoModeSection.style.display = "none";
        runModeSection.style.display = "none";
        onmessage = ({ data }) => {
            if (data.type == "showDemoMode") {
                runModeSection.style.display = "none";
                demoModeSection.style.display = "flex";
            }
            if (data.type == "showRunStart") {
                demoModeSection.style.display = "none";
                runModeSection.style.display = "flex";
                runModeSection.querySelector(".title").textContent = data.description;
                runModeSection.querySelector(".content").textContent = data.content;
            }
            if (data.type == "showRunComplete") {
                runModeSection.querySelector(".title").textContent = "Run Complete";
                runModeSection.querySelector(".content").textContent = "";
            }
        };
        parent.postMessage({}, "*");

        function updateBannerAnimation() {
            const animationName = getRandomAnimationName();
            banner.style.animation = "none";
            void banner.offsetWidth;
            banner.style.animation = "";
            banner.style.setProperty("animation-name", animationName);
            if (Math.random() < 0.5) {
                banner.style.setProperty("animation-direction", "reverse");
            } else {
                banner.style.setProperty("animation-direction", "normal");
            }
        }

        function getRandomAnimationName() {
            const animationNames = ["rotate-x", "rotate-y", "rotate-z", "scale-down", "scale-up", "fade-in-out", "skew", "shake-x", "shake-y", "grayscale", "blur", "contrast", "hue-rotate"];
            let animationIndex = 0;
            let selectedAnimationNames = [];
            const animationCount = Math.floor(Math.random() * 4) + 1;
            for (let indexRandomAnimation = 0; indexRandomAnimation < animationCount; indexRandomAnimation++) {
                selectedAnimationNames.push(animationNames[getRandomIndex(animationNames.length)]);
            }
            return selectedAnimationNames.join(", ");
        }

        function getRandomIndex(max) {
            let index;
            do {
                index = Math.floor(Math.random() * max);
            } while (randomIndicesBag.has(index));
            randomIndicesBag.add(index);
            if (randomIndicesBag.size >= max) {
                randomIndicesBag.clear();
            }
            return index;
        }
    </script>
</body>

</html>